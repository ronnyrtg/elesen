@model TradingLicense.Model.PremiseApplicationModel
@using AutoMapper;
@{
    ViewBag.Title = "Manage Premise License Application";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@{
    List<TradingLicense.Model.BusinessTypeModel> businessTypeList = new List<TradingLicense.Model.BusinessTypeModel>();
    using (var ctx = new TradingLicense.Data.LicenseApplicationContext())
    {
        var businessType = ctx.BusinessTypes.ToList();
        businessTypeList = Mapper.Map<List<TradingLicense.Model.BusinessTypeModel>>(businessType);
    }

    List<TradingLicense.Model.SelectedBusinessCodeModel> businessCodeList = new List<TradingLicense.Model.SelectedBusinessCodeModel>();

    List<TradingLicense.Model.IndividualModel> individualList = new List<TradingLicense.Model.IndividualModel>();

    List<TradingLicense.Model.PremiseTypeModel> PremiseTypeList = new List<TradingLicense.Model.PremiseTypeModel>();
    using (var ctx = new TradingLicense.Data.LicenseApplicationContext())
    {
        var premiseType = ctx.PremiseTypes.ToList();
        PremiseTypeList = Mapper.Map<List<TradingLicense.Model.PremiseTypeModel>>(premiseType);
    }

    List<TradingLicense.Model.PAStatusModel> paStatusList = new List<TradingLicense.Model.PAStatusModel>();
    using (var ctx = new TradingLicense.Data.LicenseApplicationContext())
    {
        var paStatus = ctx.PAStatus.ToList();
        paStatusList = Mapper.Map<List<TradingLicense.Model.PAStatusModel>>(paStatus);
    }

    List<SelectListItem> PremiseStatusList = new List<SelectListItem>();
    PremiseStatusList.Add(new SelectListItem { Text = "Select Premise Status", Value = "" });
    PremiseStatusList.Add(new SelectListItem { Text = "Kekal", Value = "1" });
    PremiseStatusList.Add(new SelectListItem { Text = "Separuh Kekal", Value = "2" });
    PremiseStatusList.Add(new SelectListItem { Text = "Sementara", Value = "3" });

    List<SelectListItem> PremiseModificationList = new List<SelectListItem>();
    PremiseModificationList.Add(new SelectListItem { Text = "Tiada", Value = "0" });
    PremiseModificationList.Add(new SelectListItem { Text = "Ada", Value = "1" });

}
<div id="divMessage"></div>
<div class="card">
    <div class="header">
        <h4 id="headerTitle">Manage Premise License Application</h4>
    </div>
    <div class="body">
        @using (Html.BeginForm(null, null, FormMethod.Post, new { name = "frmPremiseApplication", id = "frmPremiseApplication" }))
        {
            @Html.AntiForgeryToken()
            @Html.HiddenFor(m => m.PremiseApplicationID)
            @Html.HiddenFor(m => m.UsersID)
            @Html.HiddenFor(m => m.UserRollTemplate)
            @Html.HiddenFor(m => m.RequiredDocIds)
            @Html.HiddenFor(m => m.AdditionalDocIds)
            @Html.HiddenFor(m => m.IsDraft)

            @Html.HiddenFor(m => m.UploadRequiredDocids)
            @Html.HiddenFor(m => m.UploadAdditionalDocids)

            <div class="row">
                <div class="col-lg-3 col-md-6">
                    <div class="form-group">
                        <div class="control-label">Bussiness Type.<span class="cfont">*</span></div>
                        @Html.DropDownListFor(m => m.BusinessTypeID, new SelectList(businessTypeList.OrderBy(x => x.BusinessTypeDesc), "BusinessTypeID", "BusinessTypeDesc"), "Select Business Type", new { @class = "form-control", @onchange = "businessTypeChange()" })
                    </div>
                </div>

                <div class="col-md-offset-3 col-lg-3 col-md-3">
                    <div class="form-group">
                        @if (Model.PAStatusID == (int)TradingLicense.Infrastructure.Enums.PAStausenum.submittedtoclerk && Model.UserRollTemplate == (int)TradingLicense.Infrastructure.Enums.RollTemplate.Public)
                        {
                            <div class="control-label" style="color:green;">Submitted to Clerk</div>
                        }
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-sm-11">
                    <div class="form-group">
                        <div class="control-label">Bussiness code.<span class="cfont">*</span></div>
                        @Html.DropDownList("BusinessCode", new SelectList(Model.selectedbusinessCodeList.OrderBy(x => x.text), "id", "text"), "Select Bussiness code", new { @id = "businessCodeList", @class = "form-control", multiple = "true", onchange = "changeBussinesscode()" })
                        @Html.HiddenFor(model => model.BusinessCodeids)
                    </div>
                </div>
                <div class="col-sm-1">
                    <div class="form-group">
                        <button type="button" class="btn btn-primary" style="margin-top: 15px;" onclick='bindBusinessCodeTable(); return false;'>View</button>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-sm-11">
                    <div class="form-group">
                        <div class="control-label">
                            Mykad/Passport No.   @if (Model.UserRollTemplate > 2)
                            {<span class="cfont">*</span>}
                        </div>
                        @Html.DropDownList("Individual", new SelectList(Model.selectedIndividualList.OrderBy(x => x.text), "id", "text"), "Select  Mykad/Passport No", new { @id = "individualList", @class = "form-control", multiple = "true", onchange = "changeIndindividual()" })
                        @Html.HiddenFor(model => model.Individualids)
                    </div>
                </div>
                <div class="col-sm-1">
                    <div class="form-group">
                        <button type="button" class="btn btn-primary" style="margin-top: 15px;" onclick='bindMykadTable(); return false;'>View</button>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-sm-12">
                    <div class="form-group">
                        <div class="control-label">Premise Address</div>
                        @Html.TextBoxFor(m => m.PremiseAddress, new { @class = "form-control", @maxlength = "255" })
                        @Html.ValidationMessageFor(m => m.PremiseAddress)
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-3 col-sm-12">
                    <div class="form-group">
                        <div class="control-label">Premise Area<span class="cfont">*</span></div>
                        @Html.TextBoxFor(m => m.PremiseArea, new { @class = "form-control allownumericwithdecimal" })
                        @Html.ValidationMessageFor(m => m.PremiseArea)
                    </div>
                </div>
                <div class="col-md-3 col-sm-12">
                    <div class="form-group">
                        <div class="control-label">Premise Status<span class="cfont">*</span></div>
                        @Html.DropDownListFor(m => m.PremiseStatus, new SelectList(PremiseStatusList, "Value", "Text"), new { @class = "form-control" })
                        @Html.ValidationMessageFor(m => m.PremiseStatus)
                    </div>
                </div>
                <div class="col-md-3 col-sm-12">
                    <div class="form-group">
                        <div class="control-label">Premise Type<span class="cfont">*</span></div>
                        @Html.DropDownListFor(m => m.PremiseTypeID, new SelectList(PremiseTypeList.OrderBy(x => x.PremiseDesc), "PremiseTypeID", "PremiseDesc"), "Select Premise Type", new { @class = "form-control" })
                    </div>
                </div>
                <div class="col-md-3 col-sm-12">
                    <div class="form-group">
                        @Html.LabelFor(m => m.PremiseModification, new { @class = "control-label" })<span class="cfont">*</span>
                        @Html.DropDownListFor(m => m.PremiseModification, new SelectList(PremiseModificationList, "Value", "Text"), new { @class = "form-control" })
                        @Html.ValidationMessageFor(m => m.PremiseModification)
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col-lg-6 col-md-12" id="RequiredDocument" style="display:none;">
                    <div class="form-group">
                        <div class="control-label">
                            Document List.   @if (Model.UserRollTemplate > 1)
                            {<span class="cfont">*</span>}
                        </div>
                        <table cellspacing="0" class="table table-hover table-bordered" style="width:100%" id="tblBusinessType"></table>
                    </div>
                </div>
                <div class="col-lg-6 col-md-12" id="AdditionalDocument" style="display:none;">
                    <div class="form-group">
                        <div class="control-label">
                            Additional Document List.@if (Model.UserRollTemplate > 1)
                            {<span class="cfont">*</span>}
                        </div>
                        <table cellspacing="0" class="table table-hover table-bordered" style="width:100%" id="tblAdditional"></table>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-sm-12">
                    <div class="form-group">

                        @if (Model.UserRollTemplate == (int)TradingLicense.Infrastructure.Enums.RollTemplate.Public || Model.UserRollTemplate == (int)TradingLicense.Infrastructure.Enums.RollTemplate.DeskOfficer)
                        {
                            if (Model.UserRollTemplate == (int)TradingLicense.Infrastructure.Enums.RollTemplate.Public)
                            {
                                if (Model.PAStatusID == 0 || Model.PAStatusID == (int)TradingLicense.Infrastructure.Enums.PAStausenum.draftcreated)
                                {<input type="submit" class="btn btn-primary" onclick='frmSubmit(false); return false;' id="btnsubmitdraft" value="Save Draft " /> }
                            }

                            if (Model.PAStatusID == 0 || Model.PAStatusID == (int)TradingLicense.Infrastructure.Enums.PAStausenum.draftcreated)
                            {
                                <input type="submit" class="btn btn-primary btSubmit" value="Submit" onclick='frmSubmit(true); return false;' id="btnsubmit" />
                            }
                        }

                        @*@if (Model.UserRollTemplate > (int)TradingLicense.Infrastructure.Enums.RollTemplate.Public)
                        {
                            <input type="submit" class="btn btn-primary btSubmit" value="Submit" onclick='frmSubmit(true); return false;' id="btnsubmit" />
                        }*@

                        @if(Model.UserRollTemplate == (int)TradingLicense.Infrastructure.Enums.RollTemplate.Clerk && Model.PremiseApplicationID >0)
                        {
                            <button type="button" class="btn btn-primary" onclick='Approvedreject("approved"); return false;'>Submit</button>
                            <button type="button" class="btn btn-primary" onclick='Approvedreject("reject"); return false;'>Reject</button>
                        }

                        @if(Model.UserRollTemplate == (int)TradingLicense.Infrastructure.Enums.RollTemplate.RouteUnit && Model.PremiseApplicationID > 0)
                        {

                        }

                        @if(Model.UserRollTemplate == (int)TradingLicense.Infrastructure.Enums.RollTemplate.Supervisor && Model.PremiseApplicationID > 0)
                        {

                        }

                        @if(Model.UserRollTemplate == (int)TradingLicense.Infrastructure.Enums.RollTemplate.Director && Model.PremiseApplicationID > 0)
                        {

                        }

                        @if(Model.UserRollTemplate == (int)TradingLicense.Infrastructure.Enums.RollTemplate.CEO && Model.PremiseApplicationID > 0)
                        {

                        }

                        @if(Model.UserRollTemplate == (int)TradingLicense.Infrastructure.Enums.RollTemplate.Administrator && Model.PremiseApplicationID > 0)
                        {

                        }

                        <input type="button" class="btn btn-default" value="Cancel" onclick="back()" />
                        
                    </div>
                </div>
            </div>
        }
    </div>
</div>

<!--Business Code Modal -->
<div id="businessCodeModal" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Bussiness Code</h4>
            </div>
            <div class="modal-body">
                <table cellspacing="0" class="table table-hover table-bordered" style="width:100%" id="tblBusinessCode"></table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!--mykadCodeModal-->
<div id="mykadCodeModal" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Mykad/Passport</h4>
            </div>
            <div class="modal-body">
                <table cellspacing="0" class="table table-hover table-bordered" style="width:100%" id="tblMykad"></table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!--Upload Doc-->
<div id="uploadDocumentModal" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        @using (Html.BeginForm("UploadDocument", "PremiseApplication", FormMethod.Post, new { name = "frmuploadDocument", id = "frmuploadDocument", enctype = "multipart/form-data" }))
        {
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Upload Document</h4>
                </div>
                <div class="modal-body">
                    <input type="hidden" name="preAppid" id="preAppid">
                    <input type="hidden" name="reqDocid" id="reqDocid">
                    <input type="hidden" name="addDocid" id="addDocid">
                    <input type="hidden" name="isReqDoc" id="isReqDoc">

                    <input type="file" id="DocumentFile" name="file" accept="application/msword, application/vnd.ms-excel, application/vnd.ms-powerpoint,text/plain, application/pdf, image/*" /><br />
                </div>
                <div class="modal-footer">
                    @if (Model.UserRollTemplate > (int)TradingLicense.Infrastructure.Enums.RollTemplate.DeskOfficer)
                    {
                        <input type="button" class="btn btn-primary" onclick="return UploadDocument()" value="Upload" />
                    }
                    else
                    {
                        if (Model.UserRollTemplate == (int)TradingLicense.Infrastructure.Enums.RollTemplate.Public)
                        {
                            <input type="button" class="btn btn-primary" onclick="return UploadAttechment()" value="Upload" />
                        }
                    }
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        }
    </div>
</div>

<!--approved/reject-->
<div id="approvedrejectModal" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->

        @using (Html.BeginForm("SaveComment", "PremiseApplication", FormMethod.Post, new { name = "frmsaveComment", id = "frmsaveComment" }))
        {
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title"><lable id="lblheaderTitle"></lable></h4>
                </div>
                <div class="modal-body">
                    <textarea rows="5" cols="65" class="classOfSelector" id="txtComment" maxlength="255" autofocus="autofocus" placeholder="Comment here...">
                    </textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="return SaveComment()"><lable id="lblapprovedreject"></lable> </button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        }
       
    </div>
</div>

<style type="text/css">
    label.error {
        color: red;
    }
</style>

@section scripts{
<script>

    var userRollTemplate = 0;
    var visibleGridColume = false;
    var visibleGridUploadColume = false;

    var requiredDocList = [];
    var addtionalDocList = [];

    var actionError = '@(TempData["ErrorMessage"])';
    if (actionError != null && actionError != "") {
         errorMessage(actionError);
    }

    $(function () {

        userRollTemplate = $("#UserRollTemplate").val();
        visibleGridUploadColume = true;
            if (userRollTemplate > 1) {
                visibleGridColume = true;
            }

            $("#businessCodeList").select2();
            $("#individualList").select2();

            AddRules();

            $("#businessCodeList").select2({
                placeholder: "Search for a Business Code",
                minimumInputLength: 2,
                ajax: {
                    type: "POST",
                    url: encodeURI('@Url.Action("FillBusinessCode", "PremiseApplication")'),
                    //Data: allows us to pass a parameter to the controller
                    data: function (query) {
                        //console.log(query)
                        return { query: query.term }
                    },
                    //processes the results from the JSON method and gives us the select list
                    processResults: function (data) {
                        //console.log(data)
                        return {
                            results: data
                        };
                    }
                }
            });

             $("#individualList").select2({
                placeholder: "Select  Mykad/Passport No",
                minimumInputLength: 2,
                ajax: {
                    type: "POST",
                    url: encodeURI('@Url.Action("FillIndividual", "PremiseApplication")'),
                    //Data: allows us to pass a parameter to the controller
                    data: function (query) {
                        //console.log(query)
                        return { query: query.term }
                    },
                    //processes the results from the JSON method and gives us the select list
                    processResults: function (data) {
                        //console.log(data)
                        return {
                            results: data
                        };
                    }
                }
            });

            var businessSelecteId = [];
            if ('@Model.BusinessCodeids' != null && '@Model.BusinessCodeids' != '') {
                var BussinessCodeIds = '@Model.BusinessCodeids';

                var arr = BussinessCodeIds.split(',');
                $.each(arr, function (index, value) {
                    businessSelecteId.push(value);
                });
                $('#businessCodeList').val(businessSelecteId);
                $('#businessCodeList').trigger('change');
            } else {
                businessSelecteId = [];
            }

            var individualSelecteId = [];
            if ('@Model.Individualids' != null && '@Model.Individualids' != '') {
                var individualIds = '@Model.Individualids';

                var arr = individualIds.split(',');
                $.each(arr, function (index, value) {
                    individualSelecteId.push(value);
                });
                $('#individualList').val(individualSelecteId);
                $('#individualList').trigger('change');
            } else {
                individualSelecteId = [];
            }

           if(@Model.BusinessTypeID >0)
           {
               $("#BusinessTypeID").val(@Model.BusinessTypeID);
               bindTable();
           }

            if ('@Model.UploadRequiredDocids' != null && '@Model.UploadRequiredDocids' != '') {

                var UploadRequiredDocumentlist = '@Model.UploadRequiredDocids';

                var arr = UploadRequiredDocumentlist.split(',');
                $.each(arr, function (index, value) {
                    requiredDocList.push(value);
                });
            }

            if ('@Model.UploadAdditionalDocids' != null && '@Model.UploadAdditionalDocids' != '') {

                var UploadAdditionalDocumentlist = '@Model.UploadAdditionalDocids';

                var arr = UploadAdditionalDocumentlist.split(',');
                $.each(arr, function (index, value) {
                    addtionalDocList.push(value);
                });
            }

            $("#preAppid").val(@Model.PremiseApplicationID);

            $(".allownumericwithdecimal").on("keypress keyup blur", function (event) {
                $(this).val($(this).val().replace(/[^0-9\.]/g, ''));
                if ((event.which != 46 || $(this).val().indexOf('.') != -1) && (event.which < 48 || event.which > 57)) {
                    event.preventDefault();
                }
            });
    });

    function frmSubmit(isdraft) {

        $("#IsDraft").val(isdraft);
        $("#UploadRequiredDocids").val(requiredDocList);
        $("#UploadAdditionalDocids").val(addtionalDocList);

        AdditionalChecked();

        RequiredDocument();

            if (!$("#frmPremiseApplication").valid()) {
                return false;
            }else if ($('#BusinessCodeids').val() == "") {
                alert("Please select Business Code");
                return false;
            }else if (userRollTemplate > 1 && $('#Individualids').val() == "") {
                alert("Please select Mykad/Passport No");
                return false;
            } else if (userRollTemplate == 1 && isdraft && $('.lablereqdocument').length != requiredDocList.length) {
                alert("Please Upload all Required Document");
                return false;
            }
            else if (userRollTemplate == 1 && isdraft && $('.lableadddocument').length != addtionalDocList.length) {
                alert("Please Upload all Additional Document");
                return false;
            }
            else if (userRollTemplate > 1 && $('.chkreqdoc:checked').length != $('.chkreqdoc').length) {
                alert("Please select all checkbox for Required Document");
                return false;
            }else if (userRollTemplate > 1 && $('.chkAdddoc:checked').length != $('.chkAdddoc').length){
                alert("Please select all checkbox for Additional Document");
                return false;
            }else {
                $("#frmPremiseApplication").submit();
            }
    }

    function changeBussinesscode() {
            $('#BusinessCodeids').val($('#businessCodeList').val());
            bindAdditionalTable();
    }

    function changeIndindividual() {
            $('#Individualids').val($('#individualList').val());
    }

    function back() {
        var link = '@Url.Action("PremiseApplication", "PremiseApplication")';
        window.location.href = link;
    }

    function businessTypeChange() {
        if ($("#BusinessTypeID").val() > 0) {
             bindTable();
        }
    }

    function bindDownload(attechmentID) {
        if (attechmentID > 0) {
            window.location.href = "@Url.Action("Download", "PremiseApplication")" + "?attechmentID=" + attechmentID;
        }
    }

    function bindSearchBusinessCode() {

        var param = {};
        param["BusinessCodeids"] = $("#BusinessCodeids").val();
        return param;
    }

    function bindBusinessCodeTable() {

            if ($("#BusinessCodeids").val() == "") {
                return false;
            }

            $('#businessCodeModal').modal('show');

            if ($.fn.DataTable.isDataTable("#tblBusinessCode")) {
                $('#tblBusinessCode').dataTable().fnDestroy();
            }

            table = $("#tblBusinessCode").dataTable({
                "lengthChange": true,
                "searching": false,
                "pageLength": 50,
                "processing": true,
                "serverSide": true,
                "bPaginate": false,
                "bInfo": false,
                "orderMulti": false,
                "ajax": {
                    url: '@Url.Action("BusinessCode", "PremiseApplication")',
                    type: "POST",
                    data: bindSearchBusinessCode()
                },
                "columns": [
                    { "title": "Code Number", "data": "CodeNumber", "orderable": false },
                    { "title": "Code Description", "data": "CodeDesc", "orderable": false }
                ]
            });
    }

    function bindSearchMykad() {

        var param = {};
        param["Individualids"] = $("#Individualids").val();
        return param;
    }

    function bindMykadTable() {

            if ($("#Individualids").val() == "") {
                return false;
            }

            $('#mykadCodeModal').modal('show');

            if ($.fn.DataTable.isDataTable("#tblMykad")) {
                $('#tblMykad').dataTable().fnDestroy();
            }

            table = $("#tblMykad").dataTable({
                "lengthChange": true,
                "searching": false,
                "pageLength": 50,
                "processing": true,
                "serverSide": true,
                "bPaginate": false,
                "bInfo": false,
                "orderMulti": false,
                "ajax": {
                    url: '@Url.Action("Mykad", "PremiseApplication")',
                    type: "POST",
                    data: bindSearchMykad()
                },
                "columns": [
                    { "title": "Full Name", "data": "FullName", "orderable": false },
                    { "title": "Mykad No", "data": "MykadNo", "orderable": false }
                ]
            });
    }

    function bindSearch() {
        var param = {};
        param["businessTypeID"] = $("#BusinessTypeID").val();

        if ($("#PremiseApplicationID").val() > 0) {
            param["premiseApplicationID"] = $("#PremiseApplicationID").val();
        } else {
            param["premiseApplicationID"] = "";
        }

        return param;
    }

    function bindTable() {

            $('#RequiredDocument').show();
            if ($.fn.DataTable.isDataTable("#tblBusinessType")) {
                $('#tblBusinessType').dataTable().fnDestroy();
            }

            table = $("#tblBusinessType").dataTable({
                "lengthChange": true,
                "searching": false,
                "pageLength": 50,
                "processing": true,
                "serverSide": true,
                "bPaginate": false,
                "bInfo": false,
                "orderMulti": false,
                "ajax": {
                    url: '@Url.Action("RequiredDocument", "PremiseApplication")',
                    type: "POST",
                    data: bindSearch()
                },
                "columns": [
                    {
                        "title": "Action",
                        "data": null,
                        "render": function (data, type, row) {
                            var appendstring = '';
                            if (userRollTemplate > 1) {
                                appendstring += '<div class="checkbox"> <label for="chkdoc_' + row["RequiredDocID"] + '"> <input id="chkdoc_' + row["RequiredDocID"] + '"  value="' + row["RequiredDocID"] + '" class="chkreqdoc" type = "checkbox" onclick = "RequiredDocument();"  ' + row["IsChecked"] + ' /><span class="pointer"><img src="../images/checkmark.svg" alt="Checkmark" width="20px" height="20px" /></span></label> </div>';
                            }
                            return appendstring
                        },
                        width: "7%",
                        "orderable": false,
                        "visible": visibleGridColume,
                    },
                    { "title": "Required Document", "data": "RequiredDocDesc", "orderable": false },
                    {
                        "title": "Action",
                        "data": null,
                        "render": function (data, type, row) {
                            var appendstring = '';
                            if (userRollTemplate == 1) {
                                appendstring += '<a href="javascript:void(0);" title="Upload" data-id="' + row["RequiredDocID"] + '" onclick="RequiredDocumentModel(' + row["RequiredDocID"] + ');"> <button type="button" class="btn btn-primary">Upload</button></a>';
                            }
                            else if (userRollTemplate > 2) {
                                appendstring += '<a href="javascript:void(0);" title="Upload" data-id="' + row["RequiredDocID"] + '" onclick="RequiredDocumentModel(' + row["RequiredDocID"] + ');"> <button type="button" class="btn btn-primary">Upload</button></a>';
                            }
                            return appendstring
                        },
                        width: "7%",
                        "orderable": false,
                        "visible": visibleGridUploadColume,
                    },
                    {
                        "title": "File Name",
                        "data": null,
                        "render": function (data, type, row) {
                            var appendstring = '';

                            if (visibleGridUploadColume) {
                                if (row["AttachmentFileName"] != null && row["AttachmentFileName"] != "") {
                                    appendstring += '<a target="_blank"   href="javascript:void(0);" title="Document" onclick="bindDownload(' + row["AttachmentId"] + ');"> <label class="lablereqdocument" style="cursor: pointer;" id="lblreqAttachment_' + row["RequiredDocID"] + '"> ' + row["AttachmentFileName"] + ' </label> </a>';

                                } else {
                                    appendstring += '<a target="_blank"  href="javascript:void(0);" title="Document"> <label class="lablereqdocument"  id="lblreqAttachment_' + row["RequiredDocID"] + '"> </label> </a>';
                                }

                            } else {
                                if (row["AttachmentFileName"] != null && row["AttachmentFileName"] != "") {
                                    appendstring += '<a target="_blank" href="javascript:void(0);" title="Download" onclick="bindDownload(' + row["AttachmentId"] + "," + row["PremiseApplicationID"] + ');">' + row["AttachmentFileName"] + '</a>';
                                } else {
                                    appendstring += '<a target="_blank" href="javascript:void(0);" title=""></a>';
                                }
                            }
                            return appendstring
                        },
                        "orderable": false,
                    }
                ]
        });
    }

    function bindSearchAdditional() {
        var param = {};
        param["BusinessCodeids"] = $("#BusinessCodeids").val();

        if ($("#PremiseApplicationID").val() > 0) {
            param["premiseApplicationID"] = $("#PremiseApplicationID").val();
        } else {
            param["premiseApplicationID"] = "";
        }

        return param;
    }

    function bindAdditionalTable() {

        $('#AdditionalDocument').show();
        if ($.fn.DataTable.isDataTable("#tblAdditional")) {
            $('#tblAdditional').dataTable().fnDestroy();
        }

        table = $("#tblAdditional").dataTable({
                "lengthChange": true,
                "searching": false,
                "pageLength": 50,
                "processing": true,
                "serverSide": true,
                "bPaginate": false,
                "bInfo": false,
                "orderMulti": false,
                "ajax": {
                    url: '@Url.Action("AdditionalDocument", "PremiseApplication")',
                    type: "POST",
                    data: bindSearchAdditional()
                },
                "columns": [
                    {
                        "title": "Action",
                        "data": null,
                        "render": function (data, type, row) {
                            var appendstring = '';
                            if (userRollTemplate > 1) {
                               appendstring += '<div class="checkbox"> <label for="chkAdddoc_' + row["AdditionalDocID"] + '"> <input id="chkAdddoc_' + row["AdditionalDocID"] + '" value="' + row["AdditionalDocID"] + '" class="chkAdddoc" type = "checkbox" onclick="AdditionalChecked();" ' + row["IsChecked"] + ' /><span class="pointer"><img src="../images/checkmark.svg" alt="Checkmark" width="20px" height="20px" /></span></label> </div>';
                            }
                            return appendstring
                        },
                        "orderable": false,
                         width: "7%",
                        "visible": visibleGridColume,
                    },
                    { "title": "Additional Document", "data": "DocDesc", "orderable": false },
                    {
                        "title": "Action",
                        "data": null,
                        "render": function (data, type, row) {
                            var appendstring = '';
                            if (userRollTemplate == 1) {
                                appendstring += '<a href="javascript:void(0);" title="Upload" data-id="' + row["AdditionalDocID"] + '" onclick="AdditionalModel(' + row["AdditionalDocID"] + ');"> <button type="button" class="btn btn-primary">Upload</button></a>';
                            } else if (userRollTemplate > 2) {
                                appendstring += '<a href="javascript:void(0);" title="Upload" data-id="' + row["AdditionalDocID"] + '" onclick="AdditionalModel(' + row["AdditionalDocID"] + ');"> <button type="button" class="btn btn-primary">Upload</button></a>';
                            }
                            return appendstring
                        },
                        "orderable": false,
                        width: "7%",
                        "visible": visibleGridUploadColume,
                    },
                    {
                        "title": "File Name",
                        "data": null,
                        "render": function (data, type, row) {
                            var appendstring = '';

                            if (visibleGridUploadColume) {

                                if (row["AttachmentFileName"] != null && row["AttachmentFileName"] != "") {
                                    appendstring += '<a target="_blank"  href="javascript:void(0);" title="Document" onclick="bindDownload(' + row["AttachmentId"] + ');"> <label class="lableadddocument" style="cursor: pointer;"  id="lbladdAttachment_' + row["AdditionalDocID"] + '"> ' + row["AttachmentFileName"] + ' </label> </a>';

                                } else {
                                    appendstring += '<a target="_blank"  href="javascript:void(0);" title="Document"> <label class="lableadddocument"  id="lbladdAttachment_' + row["AdditionalDocID"] + '"> </label> </a>';
                                }

                            } else {
                                if (row["AttachmentFileName"] != null && row["AttachmentFileName"] != "") {
                                    appendstring += '<a target="_blank" href="javascript:void(0);" title="Download" onclick="bindDownload(' + row["AttachmentId"] + "," + row["PremiseApplicationID"] + ');">' + row["AttachmentFileName"] + '</a>';
                                } else {
                                    appendstring += '<a target="_blank" href="javascript:void(0);" title=""></a>';
                                }
                            }

                            return appendstring
                        },
                        "orderable": false,
                    }
                ]
        });
    }

    function RequiredDocument() {

        var RequiredArray = [];
        $('.chkreqdoc').each(function () {
            if ($(this).is(":checked")) {
                RequiredArray.push($(this).val());
            }
        });
        $("#RequiredDocIds").val(RequiredArray);
    }

    function checkButtonState() {
        var isAddtional = false;
        if ($('.chkAdddoc:checked').length == $('.chkAdddoc').length) {
            isAddtional = true;
        }

        var isDocument = false;
        if ($('.chkreqdoc:checked').length == $('.chkreqdoc').length) {
            isDocument = true;
        }

        if (isAddtional && isDocument) {
            $('.btSubmit').show();
        } else {
            $('.btSubmit').hide();
        }
    }

    function AdditionalChecked() {

        var AdditionalArray = [];
        $('.chkAdddoc').each(function () {
            if ($(this).is(":checked")) {
                AdditionalArray.push($(this).val());
            }
        });
        $("#AdditionalDocIds").val(AdditionalArray);
     }

    function RequiredDocumentModel(Requiredid) {
            $("#reqDocid").val(Requiredid);
            $("#addDocid").val("0");
            $('#isReqDoc').val("1");
            $('#uploadDocumentModal').modal('show');
        }

    function AdditionalModel(Additionalid) {
            $("#reqDocid").val("0");
            $("#addDocid").val(Additionalid);
            $('#isReqDoc').val("0");
            $('#uploadDocumentModal').modal('show');
        }

        var strValidateFileFormate = '@TradingLicense.Infrastructure.ProjectConfiguration.UploadFileFormat';
        var _validFileExtensions = [];
        _validFileExtensions = strValidateFileFormate.split(",");

        function UploadDocument(){

            if (checkforValidUploadedfiles($("#DocumentFile")[0].files, _validFileExtensions) && $('#frmuploadDocument').valid()) {

                var data = new FormData();
                var files = $("#DocumentFile").get(0).files;

                if (files.length > 0) {
                    data.append("DocumentFile", files[0]);
                }

                data.append("PremiseApplicationID", @Model.PremiseApplicationID);
                data.append("reqDocid", $("#reqDocid").val());
                data.append("addDocid", $("#addDocid").val());
                data.append("isReqDoc", $("#isReqDoc").val());

                var ajaxRequest = $.ajax({
                    type: "POST",
                    url: '@Url.Action("UploadDocument", "PremiseApplication")',
                    contentType: false,
                    processData: false,
                    data: data,
                    async: false,
                    success: function (result) {
                        if (result != null) {
                            $("#DocumentFile").val("");
                            if (result.status == 1) {
                                successMessage(result.message);

                                if ($("#isReqDoc").val() > 0) {
                                    bindTable();
                                } else {
                                    bindAdditionalTable();
                                }
                            }
                            else {
                                errorMessage(result.message);
                            }
                        }
                        $("#uploadDocumentModal").modal('hide');
                    },
                    error: function (xhr, ajaxOptions, thrownError) {
                        errorMessage(xhr.responseText);
                    }
                });

        } else {
                alert("Please Select Valid File");
            }
    }

     function UploadAttechment(){

            if (checkforValidUploadedfiles($("#DocumentFile")[0].files, _validFileExtensions) && $('#frmuploadDocument').valid()) {

                var data = new FormData();
                var files = $("#DocumentFile").get(0).files;

                if (files.length > 0) {
                    data.append("DocumentFile", files[0]);
                }

                data.append("reqDocid", $("#reqDocid").val());
                data.append("addDocid", $("#addDocid").val());
                data.append("isReqDoc", $("#isReqDoc").val());

                var ajaxRequest = $.ajax({
                    type: "POST",
                    url: '@Url.Action("UploadAttechment", "PremiseApplication")',
                    contentType: false,
                    processData: false,
                    data: data,
                    async: false,
                    success: function (result) {
                        if (result != null) {
                            $("#DocumentFile").val("");
                            if (result.status == 1) {
                                successMessage("Document Upload Successfully");

                                console.log(result.result);
                                if ($("#isReqDoc").val() > 0) {
                                    var lblreqAttachment = "lblreqAttachment_" + $("#reqDocid").val();
                                    $('.lablereqdocument').each(function () {
                                        if ($(this).attr('id') == lblreqAttachment) {
                                            $("#" + lblreqAttachment).html(result.result.AttachmentName);
                                            RequiredDocumentDublicateCheck(result.result.RequiredDocID, result.result.AttachmentID);
                                        }
                                    });
                                } else {
                                    var lbladdAttachment = "lbladdAttachment_" + $("#addDocid").val();
                                    $('.lableadddocument').each(function () {
                                        if ($(this).attr('id') == lbladdAttachment) {
                                            $("#" + lbladdAttachment).html(result.result.AttachmentName);
                                            AdditionalDocumentDublicateCheck(result.result.AdditionalDocID, result.result.AttachmentID)
                                        }
                                    });
                                }
                            }
                            else {
                                errorMessage(result.message);
                            }
                        }
                        $("#uploadDocumentModal").modal('hide');
                    },
                    error: function (xhr, ajaxOptions, thrownError) {
                        errorMessage(xhr.responseText);
                    }
                });

            } else {
                alert("Please Select Valid File");
            }
    }

    function RequiredDocumentDublicateCheck(RequiredDocID, AttachmentID) {
        var itemfound = 0;
        var itemFoundbool = false;

            for (var i = 0; i < requiredDocList.length; i++) {
                var doc = requiredDocList[i].split(',');
                var document = doc[0].split(':');
                if (document[0] == RequiredDocID ) {
                    itemfound = i;
                    itemFoundbool = true;
                    i = requiredDocList.length+1;
                }
            }

            if (itemFoundbool) {
                requiredDocList.splice(itemfound, 1);
            }

            var requiredDocument = RequiredDocID + ":" + AttachmentID;
            requiredDocList.push(requiredDocument);
        }

    function AdditionalDocumentDublicateCheck(AdditionalDocID, AttachmentID) {
        var itemfound = 0;
        var itemFoundbool = false;

            for (var i = 0; i < addtionalDocList.length; i++) {
                var doc = addtionalDocList[i].split(',');
                var document = doc[0].split(':');
                if (document[0] == AdditionalDocID) {
                    itemfound = i;
                    itemFoundbool = true;
                    i = addtionalDocList.length + 1;
                }
            }

            if (itemFoundbool) {
                addtionalDocList.splice(itemfound, 1);
            }

            var additionaDocument = AdditionalDocID + ":" + AttachmentID;
            addtionalDocList.push(additionaDocument);
    }

    function AddRules()
    {
        //validation implementation will go here.
        $("#frmsaveComment").validate({
            rules: {
                txtComment: {
                    required: true
                }
            }
        });
    }

        function Approvedreject(name) {
            if (name == "approved") {
                $("#lblapprovedreject").html("Approve");
                $("#txtComment").rules("remove", "required");
            }
            else {
                AddRules();
                $("#lblapprovedreject").html("Reject");
                $("#txtComment").rules("add", "required");
            }
            $("#lblheaderTitle").html("Add Comment");
            $('#approvedrejectModal').modal('show');
        }

        function SaveComment() {

            if (!$("#frmsaveComment").valid()) {
                return false;
            } else {

            var data = new FormData();
            data.append("PremiseApplicationID", @Model.PremiseApplicationID);
            data.append("comment", $("#txtComment").val());

            if ($("#lblapprovedreject").html() == "Approve") {
                data.append("approveRejectType", "Approve");
            } else {
                data.append("approveRejectType", "Reject");
            }

                 var ajaxRequest = $.ajax({
                        type: "POST",
                        url: '@Url.Action("SaveComment", "PremiseApplication")',
                        contentType: false,
                        processData: false,
                        data: data,
                        async: false,
                        success: function (result) {
                            if (result != null) {
                                $("#txtComment").val("");
                                if (result.status == 1) {
                                    successMessage(result.message);
                                    back();
                                }
                                else {
                                    errorMessage(result.message);
                                }
                            }
                            $("#approvedrejectModal").modal('hide');
                        },
                        error: function (xhr, ajaxOptions, thrownError) {
                            errorMessage(xhr.responseText);
                        }
                 });

            }
        }
</script>
}